<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Geração de Orçamento com IA - CVC Itaqua</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="shortcut icon" href="https://www.cvc.com.br/favicon.ico" type="image/x-icon">
</head>
<body>
  <header>
    <h1>💰 Geração de Orçamento com IA</h1>
    <nav>
      <ul>
        <li><a href="index.html">📊 Dashboard</a></li>
        <li><a href="orcamentos.html" class="active">💰 Orçamentos</a></li>
        <li><a href="cadastro-vendas.html">📈 Vendas</a></li>
        <li><a href="embarques.html">✈️ Embarques</a></li>
        <li><a href="orbiuns.html">📋 Orbiuns</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <!-- Formulário de Orçamento -->
    <section>
      <h2>📝 Dados do Orçamento</h2>
      
      <form id="orcamentoForm">
        <div class="form-section">
          <label>Tipo de orçamento:</label>
          <div class="checkbox-group">
            <label><input type="checkbox" name="tipo" value="Aéreo Facial"> ✈️ Aéreo Facial</label>
            <label><input type="checkbox" name="tipo" value="Aéreo VBI/Fácil"> ✈️ Aéreo VBI/Fácil</label>
            <label><input type="checkbox" name="tipo" value="Frete"> 📦 Frete</label>
            <label><input type="checkbox" name="tipo" value="Hotel"> 🏨 Hotel</label>
            <label><input type="checkbox" name="tipo" value="Cruzeiro"> 🚢 Cruzeiro</label>
            <label><input type="checkbox" name="tipo" value="Carro"> 🚗 Carro</label>
            <label><input type="checkbox" name="tipo" value="Traslado"> 🚌 Traslado</label>
            <label><input type="checkbox" name="tipo" value="Passeios"> 🎢 Passeios</label>
            <label><input type="checkbox" name="tipo" value="Seguro"> 🛡️ Seguro</label>
            <label><input type="checkbox" name="tipo" value="Circuito"> 🗺️ Circuito</label>
          </div>
        </div>

        <div class="form-section">
          <label for="destino">🌍 Destino:</label>
          <input type="text" name="destino" id="destino" placeholder="Ex: Orlando, Paris, Buenos Aires">
          
          <label for="adultos">👨‍👩‍👧‍👦 Adultos:</label>
          <input type="number" name="adultos" id="adultos" min="1" max="10" value="2" required />
          
          <label for="criancas">👶 Crianças:</label>
          <input type="number" name="criancas" id="criancas" min="0" max="10" value="0" onchange="atualizarIdadesCriancas()">
          
          <!-- Container para idades das crianças (aparece dinamicamente) -->
          <div id="containerIdadesCriancas" style="display: none;">
            <label>🎂 Idades das crianças:</label>
            <div id="camposIdadesCriancas"></div>
          </div>
          
          <label for="observacoes">📝 Observações e dados da viagem:</label>
          <textarea name="observacoes" id="observacoes" 
                    placeholder="Cole aqui dados de passagens, preços, links ou outras informações específicas da viagem..."
                    style="min-height: 200px; resize: vertical;"></textarea>
          <small style="color: #666; font-style: italic;">
            💡 Dica: Cole prints de orçamentos ou informações detalhadas aqui para melhor resultado
          </small>
        </div>

        <div class="form-section">
          <label for="arquivo">📎 Anexar orçamento (PDF ou imagem):</label>
          <input type="file" id="arquivo" accept=".pdf,.png,.jpg,.jpeg">

          <label>📋 Ou cole texto ou imagem (Ctrl + V):</label>
          <div id="pasteArea" contenteditable="true">
            📌 Clique aqui ou pressione Ctrl+V para colar conteúdo
          </div>
          <div id="previewArea"></div>
        </div>

        <button type="submit">🚀 Gerar Orçamento Completo</button>
      </form>
    </section>

    <!-- Resultados -->
    <div class="output-section">
      <h3>💰 Orçamento Principal
        <button class="copiar" onclick="copiarTexto('orcamentoIA')">📋 Copiar</button>
      </h3>
      <pre id="orcamentoIA">Preencha o formulário acima para gerar o orçamento...</pre>
    </div>

    <!-- Seção de Dicas do Destino com Botão -->
    <div class="output-section">
      <h3>🌍 Dicas do Destino
        <button class="gerar-dicas" onclick="gerarDicasDestino()" id="btnGerarDicas" disabled>
          🎯 Gerar Dicas
        </button>
        <button class="copiar" onclick="copiarTexto('destinoIA')" style="display: none;" id="btnCopiarDicas">📋 Copiar</button>
      </h3>
      <pre id="destinoIA">Clique em "Gerar Dicas" após criar um orçamento para obter informações sobre o destino...</pre>
    </div>

    <div class="output-section">
      <h3>🏨 Ranking de Hotéis
        <button class="copiar" onclick="copiarTexto('rankingIA')">📋 Copiar</button>
      </h3>
      <pre id="rankingIA">Será gerado automaticamente se você selecionar "Hotel"...</pre>
    </div>

    <!-- Dicas de Uso -->
    <section>
      <h2>💡 Dicas de Uso</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
        
        <div style="background: #e3f2fd; padding: 1rem; border-radius: 8px;">
          <h4>📝 Para melhores resultados:</h4>
          <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
            <li>Informe destino específico</li>
            <li>Cole dados completos nas observações</li>
            <li>Inclua links e preços reais</li>
            <li>Marque todos os tipos relevantes</li>
          </ul>
        </div>
        
        <div style="background: #e8f5e8; padding: 1rem; border-radius: 8px;">
          <h4>🤖 O que a IA faz:</h4>
          <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
            <li>Formata no padrão CVC</li>
            <li>Detecta múltiplas opções automaticamente</li>
            <li>Gera dicas personalizadas do destino</li>
            <li>Pronto para envio por WhatsApp</li>
          </ul>
        </div>
        
      </div>
    </section>
  </main>

  <footer style="text-align: center; padding: 2rem; color: #6c757d; border-top: 1px solid #e9ecef; margin-top: 3rem;">
    <p>© 2025 CVC Itaqua | Sistema de Orçamentos com IA</p>
  </footer>

  <script>
    // Função para atualizar campos de idades das crianças
    function atualizarIdadesCriancas() {
      const qtdeCriancas = parseInt(document.getElementById('criancas').value) || 0;
      const container = document.getElementById('containerIdadesCriancas');
      const camposContainer = document.getElementById('camposIdadesCriancas');
      
      if (qtdeCriancas > 0) {
        container.style.display = 'block';
        camposContainer.innerHTML = '';
        
        for (let i = 1; i <= qtdeCriancas; i++) {
          const div = document.createElement('div');
          div.style.marginBottom = '0.5rem';
          div.innerHTML = `
            <label for="idade_crianca_${i}" style="display: inline-block; width: 120px;">Criança ${i}:</label>
            <input type="number" id="idade_crianca_${i}" name="idade_crianca_${i}" 
                   min="0" max="17" placeholder="Idade" 
                   style="width: 80px; margin-right: 10px;">
            <small style="color: #666;">anos</small>
          `;
          camposContainer.appendChild(div);
        }
      } else {
        container.style.display = 'none';
        camposContainer.innerHTML = '';
      }
    }

    // Função para gerar dicas do destino (chamada manual)
    async function gerarDicasDestino() {
      const destino = document.getElementById('destino').value;
      const orcamentoTexto = document.getElementById('orcamentoIA').innerText;
      
      if (!destino) {
        alert('Informe um destino primeiro!');
        return;
      }
      
      const btnGerar = document.getElementById('btnGerarDicas');
      const btnCopiar = document.getElementById('btnCopiarDicas');
      
      btnGerar.disabled = true;
      btnGerar.innerText = '🤖 Gerando...';
      
      try {
        // Extrair datas do orçamento se disponível
        let contextoData = '';
        if (orcamentoTexto && orcamentoTexto !== 'Preencha o formulário acima para gerar o orçamento...') {
          contextoData = `\n\nCONTEXTO DA VIAGEM:\n${orcamentoTexto.substring(0, 300)}...`;
        }
        
        const prompt = `Crie dicas personalizadas sobre ${destino} para WhatsApp da CVC.${contextoData}
        
Inclua:
- Principais atrações e pontos turísticos
- Melhor época para visitar (considerando a época da viagem se informada)
- Dicas de clima e o que levar
- Informações práticas (moeda, documentação, fuso horário)
- Tom vendedor mas informativo
- Máximo 250 palavras
- Use emojis para deixar atrativo

Se há datas específicas na viagem, adapte as dicas para essa época do ano.`;

        const response = await callAI(prompt, 'destino', { destino });
        document.getElementById('destinoIA').innerText = response;
        
        btnCopiar.style.display = 'inline-block';
        console.log("✅ Dicas do destino geradas!");
        
      } catch (error) {
        console.error("❌ Erro ao gerar dicas:", error);
        document.getElementById('destinoIA').innerText = "❌ Erro ao gerar dicas: " + error.message;
      } finally {
        btnGerar.disabled = false;
        btnGerar.innerText = '🎯 Gerar Dicas';
      }
    }

    // Habilitar botão de gerar dicas quando orçamento for criado
    function habilitarBotaoDicas() {
      const btnGerar = document.getElementById('btnGerarDicas');
      if (btnGerar) {
        btnGerar.disabled = false;
      }
    }

    // Função local de copiar (mantida para compatibilidade)
    function copiarTexto(id) {
      const texto = document.getElementById(id).innerText;
      navigator.clipboard.writeText(texto).then(() => {
        // Feedback visual
        const button = event.target;
        const originalText = button.innerText;
        button.innerText = "✅ Copiado!";
        setTimeout(() => {
          button.innerText = originalText;
        }, 2000);
      }).catch(err => {
        console.error("Erro ao copiar:", err);
        alert("Erro ao copiar. Tente selecionar o texto manualmente.");
      });
    }

    // Melhorar área de paste
    const pasteArea = document.getElementById('pasteArea');
    const previewArea = document.getElementById('previewArea');

    if (pasteArea && previewArea) {
      pasteArea.addEventListener('paste', function (e) {
        const items = (e.clipboardData || e.originalEvent.clipboardData).items;
        for (let i = 0; i < items.length; i++) {
          const item = items[i];

          if (item.type.indexOf('image') !== -1) {
            const blob = item.getAsFile();
            const reader = new FileReader();
            reader.onload = function (event) {
              const img = document.createElement('img');
              img.src = event.target.result;
              img.style.maxWidth = '100%';
              previewArea.innerHTML = '';
              previewArea.appendChild(img);
              previewArea.dataset.fileData = event.target.result;
            };
            reader.readAsDataURL(blob);
          } else if (item.type === 'text/plain') {
            item.getAsString(function (text) {
              previewArea.innerHTML = '<p>' + text + '</p>';
            });
          }
        }
      });

      // Destacar área quando hover
      pasteArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.style.borderColor = '#003399';
        this.style.backgroundColor = '#e9ecef';
      });

      pasteArea.addEventListener('dragleave', function(e) {
        this.style.borderColor = '#007bff';
        this.style.backgroundColor = '#f8f9fa';
      });
    }

    // Destacar página atual na navegação
    document.addEventListener('DOMContentLoaded', function() {
      const currentPage = window.location.pathname.split('/').pop() || 'index.html';
      const navLinks = document.querySelectorAll('nav a');
      
      navLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href === currentPage) {
          link.classList.add('active');
        } else {
          link.classList.remove('active');
        }
      });
    });
  </script>

  <script src="ai.js"></script>
</body>
</html>
