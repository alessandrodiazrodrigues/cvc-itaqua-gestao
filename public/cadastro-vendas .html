<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìà Cadastro de Vendas - CVC Itaqua</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .vendas-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }

        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border-left: 4px solid;
            transition: all 0.3s ease;
            text-align: center;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(0,0,0,0.12);
        }

        .stat-card.vendas { border-left-color: #28a745; }
        .stat-card.meta { border-left-color: #007bff; }
        .stat-card.comissao { border-left-color: #ffc107; }
        .stat-card.performance { border-left-color: #dc3545; }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 0.5rem;
        }

        .stat-period {
            font-size: 0.75rem;
            color: #999;
            font-style: italic;
        }

        .form-vendas {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }

        .form-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #003399;
        }

        .form-section h3 {
            color: #003399;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.75rem;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #003399;
            box-shadow: 0 0 0 3px rgba(0,51,153,0.1);
            transform: translateY(-1px);
        }

        .form-group input[type="number"] {
            text-align: right;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            background: white;
            border-radius: 6px;
            border: 1px solid #e1e8ed;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .checkbox-item:hover {
            background: rgba(0,51,153,0.05);
            border-color: #003399;
        }

        .checkbox-item input {
            margin-right: 0.5rem;
            transform: scale(1.2);
        }

        .btn-submit {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 1rem;
            box-shadow: 0 4px 15px rgba(40,167,69,0.3);
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(40,167,69,0.4);
        }

        .btn-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .calculadora-meta {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            border-left: 4px solid #2196f3;
        }

        .calculadora-meta h4 {
            color: #1976d2;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .calculo-result {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-weight: 600;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .progress-fill {
            background: linear-gradient(135deg, #28a745, #20c997);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid;
        }

        .alert-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .alert-error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #003399;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .historico-vendas {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-top: 2rem;
        }

        .venda-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid #28a745;
            transition: all 0.3s ease;
        }

        .venda-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .venda-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .venda-valor {
            font-size: 1.2rem;
            font-weight: bold;
            color: #28a745;
        }

        .venda-data {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .btn-action {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-action:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        .senha-container {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .senha-input {
            font-size: 1.2rem;
            padding: 1rem;
            border: 2px solid #ffc107;
            border-radius: 8px;
            margin: 1rem;
            text-align: center;
            font-family: monospace;
        }

        @media (max-width: 768px) {
            .vendas-container {
                padding: 1rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .stats-dashboard {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .header-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>üìà Cadastro de Vendas - CVC Itaqua</h1>
        <nav>
            <ul>
                <li><a href="index.html">üìä Dashboard</a></li>
                <li><a href="orcamentos.html">üí∞ Or√ßamentos</a></li>
                <li><a href="cadastro-vendas.html" class="active">üìà Vendas</a></li>
                <li><a href="embarques.html">‚úàÔ∏è Embarques</a></li>
                <li><a href="orbiuns.html">üìã Orbiuns</a></li>
            </ul>
        </nav>
    </header>

    <main class="vendas-container">
        <!-- Sistema de Senha -->
        <div id="senhaContainer" class="senha-container">
            <h2>üîê Acesso Restrito</h2>
            <p>Digite a senha para acessar o sistema de vendas:</p>
            <input type="password" id="senhaInput" class="senha-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="8">
            <br>
            <button onclick="verificarSenha()" class="btn-action">üîë Entrar</button>
            <div class="alert alert-warning" style="margin-top: 1rem;">
                <strong>‚ö†Ô∏è Aten√ß√£o:</strong> Acesso apenas para vendedores autorizados da CVC Itaqua.
            </div>
        </div>

        <!-- Conte√∫do Principal (inicialmente oculto) -->
        <div id="sistemaVendas" style="display: none;">
            
            <!-- Dashboard de Performance -->
            <section>
                <div class="header-actions">
                    <button onclick="carregarDashboard()" class="btn-action">
                        üîÑ Atualizar Dashboard
                    </button>
                    <button onclick="exportarRelatorio()" class="btn-action">
                        üìä Exportar Relat√≥rio
                    </button>
                    <button onclick="abrirGoogleSheets()" class="btn-action">
                        üìã Ver Planilha
                    </button>
                </div>

                <div class="stats-dashboard">
                    <div class="stat-card vendas">
                        <div class="stat-number" id="totalVendasMes">R$ 0</div>
                        <div class="stat-label">Vendas do M√™s</div>
                        <div class="stat-period">Janeiro 2025</div>
                    </div>
                    
                    <div class="stat-card meta">
                        <div class="stat-number" id="metaMensal">R$ 50.000</div>
                        <div class="stat-label">Meta Mensal</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressoMeta" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="stat-card comissao">
                        <div class="stat-number" id="comissaoMes">R$ 0</div>
                        <div class="stat-label">Comiss√£o Estimada</div>
                        <div class="stat-period">Base: 3.5%</div>
                    </div>
                    
                    <div class="stat-card performance">
                        <div class="stat-number" id="percentualMeta">0%</div>
                        <div class="stat-label">Performance</div>
                        <div class="stat-period" id="statusMeta">Abaixo da Meta</div>
                    </div>
                </div>
            </section>

            <!-- Formul√°rio de Nova Venda -->
            <section>
                <div class="form-vendas">
                    <h2>üí∞ Registrar Nova Venda</h2>
                    
                    <form id="formVenda">
                        <!-- Dados da Venda -->
                        <div class="form-section">
                            <h3>üìã Informa√ß√µes da Venda</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="vendedor">üë§ Vendedor</label>
                                    <select id="vendedor" name="vendedor" required>
                                        <option value="">Selecione...</option>
                                        <option value="Adriana">Adriana</option>
                                        <option value="Adrielly">Adrielly</option>
                                        <option value="Alessandro">Alessandro</option>
                                        <option value="Ana Paula">Ana Paula</option>
                                        <option value="Bia">Bia</option>
                                        <option value="Concei√ß√£o">Concei√ß√£o</option>
                                        <option value="Jhully">Jhully</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="dataVenda">üìÖ Data da Venda</label>
                                    <input type="date" id="dataVenda" name="dataVenda" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="valorVenda">üíµ Valor da Venda</label>
                                    <input type="number" id="valorVenda" name="valorVenda" step="0.01" min="0" 
                                           placeholder="0,00" required oninput="calcularComissao()">
                                </div>
                                
                                <div class="form-group">
                                    <label for="comissaoVenda">üí∞ Comiss√£o (%)</label>
                                    <select id="comissaoVenda" name="comissaoVenda" onchange="calcularComissao()">
                                        <option value="3.5">3.5% (Padr√£o)</option>
                                        <option value="4.0">4.0% (Meta Atingida)</option>
                                        <option value="4.5">4.5% (Performance Alta)</option>
                                        <option value="5.0">5.0% (Excepcional)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Dados do Cliente -->
                        <div class="form-section">
                            <h3>üë• Dados do Cliente</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="nomeCliente">üìù Nome do Cliente</label>
                                    <input type="text" id="nomeCliente" name="nomeCliente" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="telefoneCliente">üìû Telefone/WhatsApp</label>
                                    <input type="tel" id="telefoneCliente" name="telefoneCliente" 
                                           placeholder="(11) 99999-9999">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="emailCliente">üìß E-mail</label>
                                    <input type="email" id="emailCliente" name="emailCliente">
                                </div>
                                
                                <div class="form-group">
                                    <label for="cidadeCliente">üèôÔ∏è Cidade</label>
                                    <input type="text" id="cidadeCliente" name="cidadeCliente" 
                                           placeholder="Ex: S√£o Paulo, SP">
                                </div>
                            </div>
                        </div>

                        <!-- Detalhes do Produto -->
                        <div class="form-section">
                            <h3>üéØ Produto Vendido</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="tipoViagem">‚úàÔ∏è Tipo de Viagem</label>
                                    <select id="tipoViagem" name="tipoViagem" required>
                                        <option value="">Selecione...</option>
                                        <option value="Pacote Nacional">üìç Pacote Nacional</option>
                                        <option value="Pacote Internacional">üåç Pacote Internacional</option>
                                        <option value="A√©reo Nacional">‚úàÔ∏è A√©reo Nacional</option>
                                        <option value="A√©reo Internacional">üåé A√©reo Internacional</option>
                                        <option value="Hotel Nacional">üè® Hotel Nacional</option>
                                        <option value="Hotel Internacional">üè© Hotel Internacional</option>
                                        <option value="Cruzeiro">üö¢ Cruzeiro</option>
                                        <option value="Seguro Viagem">üõ°Ô∏è Seguro Viagem</option>
                                        <option value="Outros">üì¶ Outros</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="destino">üó∫Ô∏è Destino</label>
                                    <input type="text" id="destino" name="destino" 
                                           placeholder="Ex: Orlando, Paris, Rio de Janeiro">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="dataViagem">üóìÔ∏è Data da Viagem</label>
                                    <input type="date" id="dataViagem" name="dataViagem">
                                </div>
                                
                                <div class="form-group">
                                    <label for="passageiros">üë• N¬∫ de Passageiros</label>
                                    <input type="number" id="passageiros" name="passageiros" min="1" max="20" value="2">
                                </div>
                            </div>
                        </div>

                        <!-- Observa√ß√µes -->
                        <div class="form-section">
                            <h3>üìù Observa√ß√µes</h3>
                            <div class="form-group">
                                <label for="observacoes">üí¨ Observa√ß√µes da Venda</label>
                                <textarea id="observacoes" name="observacoes" rows="3" 
                                          placeholder="Detalhes adicionais, forma de pagamento, etc..."></textarea>
                            </div>
                        </div>

                        <!-- Calculadora de Meta -->
                        <div class="calculadora-meta">
                            <h4>üéØ Calculadora de Performance</h4>
                            <div class="calculo-result" id="resultadoCalculo">
                                <div>üí∞ Comiss√£o desta venda: <span id="comissaoCalculada">R$ 0,00</span></div>
                                <div>üìà Progresso na meta: <span id="progressoCalculado">0%</span></div>
                                <div>üéØ Restam para a meta: <span id="faltaMeta">R$ 50.000,00</span></div>
                            </div>
                        </div>

                        <button type="submit" class="btn-submit">
                            üíæ Registrar Venda
                        </button>
                    </form>
                </div>
            </section>

            <!-- Hist√≥rico de Vendas -->
            <section class="historico-vendas">
                <h2>üìä √öltimas Vendas</h2>
                <div id="loadingHistorico" class="alert alert-info" style="display: none;">
                    <span class="loading-spinner"></span> Carregando hist√≥rico de vendas...
                </div>
                <div id="listaVendas">
                    <!-- Vendas ser√£o carregadas dinamicamente -->
                </div>
            </section>
        </div>
    </main>

    <script>
        // ================================================================================
        // üîê SISTEMA DE AUTENTICA√á√ÉO
        // ================================================================================
        
        const SENHA_VENDAS = 'CVC2025!';
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/SEU_SCRIPT_ID/exec';
        const PLANILHA_URL = 'https://docs.google.com/spreadsheets/d/SEU_SHEET_ID/edit';
        
        let vendedorLogado = '';
        let vendasData = [];
        let metaMensal = 50000; // Meta padr√£o R$ 50.000

        function verificarSenha() {
            const senha = document.getElementById('senhaInput').value;
            
            if (senha === SENHA_VENDAS) {
                document.getElementById('senhaContainer').style.display = 'none';
                document.getElementById('sistemaVendas').style.display = 'block';
                
                // Configurar data atual
                document.getElementById('dataVenda').valueAsDate = new Date();
                
                // Carregar dashboard
                carregarDashboard();
                
                console.log('‚úÖ Acesso autorizado ao sistema de vendas');
            } else {
                alert('‚ùå Senha incorreta! Tente novamente.');
                document.getElementById('senhaInput').value = '';
            }
        }

        // ================================================================================
        // üìä DASHBOARD E M√âTRICAS
        // ================================================================================

        async function carregarDashboard() {
            console.log('üìä Carregando dashboard de vendas...');
            
            try {
                // Simular carregamento (substituir por chamada real √† API)
                await simularCarregamentoDados();
                
                atualizarDashboard();
                carregarHistoricoVendas();
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar dashboard:', error);
                mostrarAlerta('Erro ao carregar dados do dashboard', 'error');
            }
        }

        async function simularCarregamentoDados() {
            // Simular dados para demonstra√ß√£o
            // Na vers√£o real, isso seria uma chamada para o Google Sheets
            
            const hoje = new Date();
            const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
            
            vendasData = [
                {
                    vendedor: 'Adriana',
                    valor: 15420.50,
                    cliente: 'Maria Silva',
                    produto: 'Pacote Orlando',
                    data: '2025-01-15',
                    comissao: 539.72
                },
                {
                    vendedor: 'Alessandro',
                    valor: 8750.00,
                    cliente: 'Jo√£o Santos',
                    produto: 'A√©reo Nacional',
                    data: '2025-01-20',
                    comissao: 306.25
                }
            ];
        }

        function atualizarDashboard() {
            const hoje = new Date();
            const mesAtual = hoje.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
            
            // Calcular totais
            const totalVendas = vendasData.reduce((sum, venda) => sum + venda.valor, 0);
            const totalComissao = vendasData.reduce((sum, venda) => sum + venda.comissao, 0);
            const percentualMeta = (totalVendas / metaMensal) * 100;
            
            // Atualizar elementos
            document.getElementById('totalVendasMes').textContent = formatarMoeda(totalVendas);
            document.getElementById('metaMensal').textContent = formatarMoeda(metaMensal);
            document.getElementById('comissaoMes').textContent = formatarMoeda(totalComissao);
            document.getElementById('percentualMeta').textContent = percentualMeta.toFixed(1) + '%';
            document.getElementById('progressoMeta').style.width = Math.min(percentualMeta, 100) + '%';
            
            // Atualizar per√≠odo
            document.querySelectorAll('.stat-period').forEach(el => {
                if (el.textContent.includes('2025')) {
                    el.textContent = mesAtual;
                }
            });
            
            // Status da meta
            const statusMeta = document.getElementById('statusMeta');
            if (percentualMeta >= 100) {
                statusMeta.textContent = 'üèÜ Meta Atingida!';
                statusMeta.style.color = '#28a745';
            } else if (percentualMeta >= 80) {
                statusMeta.textContent = 'üéØ Quase L√°!';
                statusMeta.style.color = '#ffc107';
            } else {
                statusMeta.textContent = 'üìà Em Progresso';
                statusMeta.style.color = '#dc3545';
            }
        }

        function carregarHistoricoVendas() {
            const container = document.getElementById('listaVendas');
            
            if (vendasData.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        üìù Nenhuma venda registrada este m√™s. Que tal come√ßar agora?
                    </div>
                `;
                return;
            }
            
            container.innerHTML = vendasData.map(venda => `
                <div class="venda-item">
                    <div class="venda-header">
                        <div>
                            <strong>${venda.cliente}</strong> - ${venda.produto}
                        </div>
                        <div class="venda-valor">${formatarMoeda(venda.valor)}</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <small>üë§ ${venda.vendedor} | üìÖ ${formatarData(venda.data)}</small>
                        </div>
                        <div>
                            <small>üí∞ Comiss√£o: ${formatarMoeda(venda.comissao)}</small>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ================================================================================
        // üìù FORMUL√ÅRIO DE VENDAS
        // ================================================================================

        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('formVenda');
            if (form) {
                form.addEventListener('submit', enviarVenda);
            }
            
            // Configurar data atual
            const hoje = new Date().toISOString().split('T')[0];
            if (document.getElementById('dataVenda')) {
                document.getElementById('dataVenda').value = hoje;
            }
        });

        async function enviarVenda(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const dados = Object.fromEntries(formData.entries());
            
            // Valida√ß√µes
            if (!validarFormulario(dados)) {
                return;
            }
            
            // Mostrar loading
            const submitBtn = e.target.querySelector('.btn-submit');
            const textoOriginal = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading-spinner"></span> Enviando...';

            try {
                // Adicionar dados calculados
                dados.comissaoValor = calcularValorComissao(dados.valorVenda, dados.comissaoVenda);
                dados.dataRegistro = new Date().toISOString();
                dados.metaMensal = metaMensal;
                
                console.log('üì§ Enviando venda:', dados);
                
                // Simular envio (substituir por chamada real ao Google Sheets)
                await simularEnvioVenda(dados);
                
                // Sucesso
                mostrarAlerta('‚úÖ Venda registrada com sucesso!', 'success');
                
                // Limpar formul√°rio
                e.target.reset();
                document.getElementById('dataVenda').valueAsDate = new Date();
                
                // Atualizar dashboard
                carregarDashboard();
                
            } catch (error) {
                console.error('‚ùå Erro ao enviar venda:', error);
                mostrarAlerta('Erro ao registrar venda: ' + error.message, 'error');
                
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = textoOriginal;
            }
        }

        async function simularEnvioVenda(dados) {
            // Simular delay de rede
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Adicionar √† lista local (na vers√£o real, seria salvo no Google Sheets)
            vendasData.unshift({
                vendedor: dados.vendedor,
                valor: parseFloat(dados.valorVenda),
                cliente: dados.nomeCliente,
                produto: dados.tipoViagem + (dados.destino ? ` - ${dados.destino}` : ''),
                data: dados.dataVenda,
                comissao: dados.comissaoValor
            });
            
            // Simular poss√≠vel erro (5% de chance)
            if (Math.random() < 0.05) {
                throw new Error('Falha na conex√£o com o servidor');
            }
        }

        function validarFormulario(dados) {
            const erros = [];
            
            if (!dados.vendedor) erros.push('Selecione o vendedor');
            if (!dados.valorVenda || parseFloat(dados.valorVenda) <= 0) erros.push('Valor da venda deve ser maior que zero');
            if (!dados.nomeCliente || dados.nomeCliente.length < 2) erros.push('Nome do cliente √© obrigat√≥rio');
            if (!dados.tipoViagem) erros.push('Selecione o tipo de viagem');
            if (!dados.dataVenda) erros.push('Data da venda √© obrigat√≥ria');
            
            // Validar data da venda (n√£o pode ser futura)
            const dataVenda = new Date(dados.dataVenda);
            const hoje = new Date();
            if (dataVenda > hoje) {
                erros.push('Data da venda n√£o pode ser futura');
            }
            
            if (erros.length > 0) {
                mostrarAlerta('Corrija os seguintes erros:\n‚Ä¢ ' + erros.join('\n‚Ä¢ '), 'error');
                return false;
            }
            
            return true;
        }

        // ================================================================================
        // üßÆ CALCULADORAS E UTILIT√ÅRIOS
        // ================================================================================

        function calcularComissao() {
            const valor = parseFloat(document.getElementById('valorVenda').value) || 0;
            const percentual = parseFloat(document.getElementById('comissaoVenda').value) || 3.5;
            
            const comissao = calcularValorComissao(valor, percentual);
            const totalAtual = vendasData.reduce((sum, venda) => sum + venda.valor, 0);
            const novoTotal = totalAtual + valor;
            const progresso = (novoTotal / metaMensal) * 100;
            const falta = Math.max(0, metaMensal - novoTotal);
            
            // Atualizar calculadora
            document.getElementById('comissaoCalculada').textContent = formatarMoeda(comissao);
            document.getElementById('progressoCalculado').textContent = progresso.toFixed(1) + '%';
            document.getElementById('faltaMeta').textContent = formatarMoeda(falta);
        }

        function calcularValorComissao(valor, percentual) {
            return (parseFloat(valor) * parseFloat(percentual)) / 100;
        }

        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor);
        }

        function formatarData(dataString) {
            const data = new Date(dataString + 'T00:00:00');
            return data.toLocaleDateString('pt-BR');
        }

        function mostrarAlerta(mensagem, tipo = 'info') {
            // Remover alertas existentes
            const alertasExistentes = document.querySelectorAll('.alerta-temporario');
            alertasExistentes.forEach(alerta => alerta.remove());
            
            // Criar novo alerta
            const alerta = document.createElement('div');
            alerta.className = `alert alert-${tipo} alerta-temporario`;
            alerta.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                max-width: 400px;
                z-index: 10000;
                box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                animation: slideIn 0.3s ease;
            `;
            
            let icone = 'üìù';
            if (tipo === 'success') icone = '‚úÖ';
            if (tipo === 'error') icone = '‚ùå';
            if (tipo === 'warning') icone = '‚ö†Ô∏è';
            
            alerta.innerHTML = `
                ${icone} ${mensagem}
                <button onclick="this.parentElement.remove()" 
                        style="float: right; background: none; border: none; 
                               font-size: 18px; cursor: pointer; margin-left: 10px;">√ó</button>
            `;
            
            document.body.appendChild(alerta);
            
            // Remover automaticamente ap√≥s 5 segundos
            setTimeout(() => {
                if (alerta.parentElement) {
                    alerta.remove();
                }
            }, 5000);
        }

        // ================================================================================
        // üîß FUNCIONALIDADES AUXILIARES
        // ================================================================================

        function exportarRelatorio() {
            const dados = {
                vendas: vendasData,
                resumo: {
                    totalVendas: vendasData.reduce((sum, v) => sum + v.valor, 0),
                    totalComissao: vendasData.reduce((sum, v) => sum + v.comissao, 0),
                    metaMensal: metaMensal,
                    numeroVendas: vendasData.length
                },
                dataExportacao: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(dados, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `relatorio-vendas-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            
            mostrarAlerta('üìä Relat√≥rio exportado com sucesso!', 'success');
        }

        function abrirGoogleSheets() {
            window.open(PLANILHA_URL, '_blank');
        }

        function alterarMeta() {
            const novaMeta = prompt('Digite a nova meta mensal (apenas n√∫meros):', metaMensal);
            
            if (novaMeta && !isNaN(novaMeta) && parseFloat(novaMeta) > 0) {
                metaMensal = parseFloat(novaMeta);
                atualizarDashboard();
                mostrarAlerta(`üéØ Meta alterada para ${formatarMoeda(metaMensal)}`, 'success');
            }
        }

        // ================================================================================
        // üé® MELHORIAS DE UX
        // ================================================================================

        // M√°scara para telefone
        document.addEventListener('DOMContentLoaded', function() {
            const telefoneInput = document.getElementById('telefoneCliente');
            if (telefoneInput) {
                telefoneInput.addEventListener('input', function(e) {
                    let valor = e.target.value.replace(/\D/g, '');
                    valor = valor.replace(/^(\d{2})(\d)/g, '($1) $2');
                    valor = valor.replace(/(\d)(\d{4})$/, '$1-$2');
                    e.target.value = valor;
                });
            }
        });

        // Formata√ß√£o autom√°tica do valor
        document.addEventListener('DOMContentLoaded', function() {
            const valorInput = document.getElementById('valorVenda');
            if (valorInput) {
                valorInput.addEventListener('blur', function(e) {
                    const valor = parseFloat(e.target.value);
                    if (!isNaN(valor)) {
                        e.target.value = valor.toFixed(2);
                    }
                });
            }
        });

        // Auto-completar destinos populares
        const destinosPopulares = [
            'Orlando, FL', 'Paris, Fran√ßa', 'Buenos Aires, Argentina',
            'Rio de Janeiro, RJ', 'Salvador, BA', 'Fortaleza, CE',
            'Lisboa, Portugal', 'Madrid, Espanha', 'Roma, It√°lia',
            'Nova York, NY', 'Canc√∫n, M√©xico', 'Punta Cana, Rep. Dominicana'
        ];

        document.addEventListener('DOMContentLoaded', function() {
            const destinoInput = document.getElementById('destino');
            if (destinoInput) {
                destinoInput.addEventListener('input', function(e) {
                    // Implementar autocomplete simples
                    const valor = e.target.value.toLowerCase();
                    const sugestoes = destinosPopulares.filter(d => 
                        d.toLowerCase().includes(valor)
                    );
                    
                    // Mostrar primeira sugest√£o como placeholder
                    if (sugestoes.length > 0 && valor.length > 2) {
                        e.target.setAttribute('placeholder', sugestoes[0]);
                    }
                });
            }
        });

        // Atalhos do teclado
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                const form = document.getElementById('formVenda');
                if (form) {
                    form.requestSubmit();
                }
            }
            
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                carregarDashboard();
            }
        });

        // ================================================================================
        // üöÄ INICIALIZA√á√ÉO
        // ================================================================================

        // Permitir Enter na senha
        document.addEventListener('DOMContentLoaded', function() {
            const senhaInput = document.getElementById('senhaInput');
            if (senhaInput) {
                senhaInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        verificarSenha();
                    }
                });
            }
        });

        // CSS para anima√ß√µes
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);

        console.log('üöÄ Sistema de Cadastro de Vendas CVC Itaqua carregado!');
        console.log('‚ú® Funcionalidades:');
        console.log('   üìä Dashboard de performance em tempo real');
        console.log('   üí∞ C√°lculo autom√°tico de comiss√µes');
        console.log('   üéØ Acompanhamento de metas mensais');
        console.log('   üì± Interface responsiva e intuitiva');
        console.log('   üîê Sistema de autentica√ß√£o por senha');
        console.log('   üìà Hist√≥rico de vendas integrado');
        console.log('   ‚å®Ô∏è Atalhos: Ctrl+S (Salvar) | Ctrl+R (Atualizar)');
    </script>
</body>
</html>
