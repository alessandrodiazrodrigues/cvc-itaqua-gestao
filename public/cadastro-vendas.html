<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìà Sistema de Vendas - CVC Itaqua</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        .vendas-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            font-family: 'Nunito', sans-serif;
        }

        .form-vendas {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }

        .form-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #003399;
        }

        .form-section h3 {
            color: #003399;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.75rem;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #003399;
            box-shadow: 0 0 0 3px rgba(0,51,153,0.1);
            transform: translateY(-1px);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            background: white;
            border-radius: 6px;
            border: 1px solid #e1e8ed;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .checkbox-item:hover {
            background: rgba(0,51,153,0.05);
            border-color: #003399;
        }

        .checkbox-item input {
            margin-right: 0.5rem;
            transform: scale(1.2);
        }

        .radio-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .radio-item {
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem;
            background: white;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .radio-item:hover {
            border-color: #003399;
            background: rgba(0,51,153,0.05);
        }

        .radio-item input {
            margin-right: 0.5rem;
        }

        .radio-item.selected {
            border-color: #003399;
            background: rgba(0,51,153,0.1);
        }

        .recibo-container {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #28a745;
            position: relative;
        }

        .recibo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .recibo-number {
            background: #28a745;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .btn-remove-recibo {
            background: #dc3545;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .btn-remove-recibo:hover {
            background: #c82333;
            transform: scale(1.05);
        }

        .extra-fields {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255,255,255,0.7);
            border-radius: 8px;
            border-left: 3px solid #ffc107;
            display: none;
        }

        .multi-datas {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255,255,255,0.7);
            border-radius: 8px;
            border-left: 3px solid #17a2b8;
            display: none;
        }

        .datas-extras {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .btn-add {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 0.5rem;
        }

        .btn-add:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-remove {
            background: #dc3545;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            margin: 0.5rem;
        }

        .btn-submit {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 2rem;
            box-shadow: 0 4px 15px rgba(40,167,69,0.3);
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(40,167,69,0.4);
        }

        .btn-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .bagagem-assento {
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #003399;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid;
        }

        .alert-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .alert-info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }

        @media (max-width: 768px) {
            .vendas-container {
                padding: 1rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .radio-group {
                flex-direction: column;
            }
            
            .bagagem-assento {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>üìà Sistema de Vendas - CVC Itaqua</h1>
        <nav>
            <ul>
                <li><a href="index.html">üìä Dashboard</a></li>
                <li><a href="orcamentos.html">üí∞ Or√ßamentos</a></li>
                <li><a href="vendas.html" class="active">üìà Vendas</a></li>
                <li><a href="embarques.html">‚úàÔ∏è Embarques</a></li>
                <li><a href="orbiuns.html">üìã Orbiuns</a></li>
            </ul>
        </nav>
    </header>

    <main class="vendas-container">
        <div class="form-vendas">
            <h2>üìã Cadastro Completo de Venda</h2>
            
            <form id="formVendaCompleta">
                <!-- Informa√ß√µes Gerais -->
                <div class="form-section">
                    <h3>üìã Informa√ß√µes Gerais</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nInforme">üìÑ N¬∫ do Informe</label>
                            <input type="number" id="nInforme" name="nInforme" placeholder="Deixe em branco para gerar autom√°tico">
                        </div>
                        
                        <div class="form-group">
                            <label>üè¢ Filial</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" name="filial" value="6220" id="filial6220" required>
                                    <label for="filial6220">6220 - Itaquaquecetuba</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="filial" value="6223" id="filial6223">
                                    <label for="filial6223">6223</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>üì¶ Tipo de Pacote</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" name="pacote" value="Nacional" id="pacoteNacional">
                                <label for="pacoteNacional">üáßüá∑ Nacional</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" name="pacote" value="Internacional" id="pacoteInternacional">
                                <label for="pacoteInternacional">üåç Internacional</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" name="pacote" value="Mar√≠timo" id="pacoteMaritimo">
                                <label for="pacoteMaritimo">üö¢ Mar√≠timo</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="vendedor">üë§ Vendedor</label>
                            <select id="vendedor" name="vendedor" required>
                                <option value="">Selecione...</option>
                                <option value="Alessandro">Alessandro</option>
                                <option value="Ana Paula">Ana Paula</option>
                                <option value="Adriana">Adriana</option>
                                <option value="Adrielly">Adrielly</option>
                                <option value="Bia">Bia</option>
                                <option value="Concei√ß√£o">Concei√ß√£o</option>
                                <option value="Jhully">Jhully</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Dados do Cliente -->
                <div class="form-section">
                    <h3>üë• Dados do Cliente</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cpfCliente">üìÑ CPF</label>
                            <input type="text" id="cpfCliente" name="cpfCliente" required 
                                   placeholder="000.000.000-00" maxlength="14">
                        </div>
                        
                        <div class="form-group">
                            <label for="nomeCliente">üìù Nome Completo</label>
                            <input type="text" id="nomeCliente" name="nomeCliente" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="whatsappCliente">üìû WhatsApp</label>
                            <input type="text" id="whatsappCliente" name="whatsappCliente" 
                                   placeholder="(11) 99999-9999" maxlength="15">
                        </div>
                    </div>
                </div>

                <!-- Recibos -->
                <div class="form-section">
                    <h3>üßæ Recibos e Servi√ßos</h3>
                    
                    <div id="recibosContainer">
                        <!-- Recibos ser√£o adicionados dinamicamente -->
                    </div>
                    
                    <div style="text-align: center; margin-top: 1rem;">
                        <button type="button" class="btn-add" onclick="adicionarRecibo()">
                            ‚ûï Adicionar Recibo
                        </button>
                        <button type="button" id="btnRemoverRecibo" class="btn-remove" 
                                onclick="removerUltimoRecibo()" style="display: none;">
                            ‚ûñ Remover √öltimo
                        </button>
                    </div>
                </div>

                <!-- Seguro -->
                <div class="form-section">
                    <h3>üõ°Ô∏è Seguro Viagem</h3>
                    
                    <div class="form-group">
                        <label>Situa√ß√£o do Seguro</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="seguro" value="recusado" id="seguroRecusado">
                                <label for="seguroRecusado">‚ùå Oferecido e RECUSADO</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="seguro" value="nao_oferecido" id="seguroNaoOferecido">
                                <label for="seguroNaoOferecido">‚ö†Ô∏è N√£o Ofertou</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="seguro" value="comprou" id="seguroComprou">
                                <label for="seguroComprou">‚úÖ COMPROU</label>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn-submit">
                    üíæ Cadastrar Venda Completa
                </button>
            </form>
        </div>
    </main>

    <script>
        // ================================================================================
        // üîß CONFIGURA√á√ïES
        // ================================================================================
        
        const API_URL = 'https://script.google.com/macros/s/AKfycbzrigpXOzcK-4ezlXLmh99vDLTea2E2U6MEvgTTo7aFI6AI33lhHtl_M6_WWfTZGp8O/exec';
        
        const COMPANHIAS_AEREAS = [
            'LATAM', 'AZUL', 'GOL', 'VOEPASS',
            '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',
            'CRUZEIRO MSC', 'CRUZEIRO COSTA', 'CRUZEIRO TEM√ÅTICO', 'CRUZEIRO NCL', 
            'CRUZEIRO DISNEY', 'CRUZEIROS OUTROS',
            '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',
            'Aerol√≠neas Argentinas', 'Aerom√©xico', 'Air Canada', 'Air China', 
            'Air Europa', 'Air France', 'American Airlines', 'Arajet', 'Avianca',
            'Boliviana de Aviaci√≥n (BoA)', 'British Airways', 'Copa Airlines',
            'Delta Air Lines', 'Emirates', 'Ethiopian Airlines', 'Flybondi',
            'Iberia', 'ITA Airways', 'JetSmart', 'KLM', 'Lufthansa',
            'Qatar Airways', 'Royal Air Maroc', 'Sky Airline', 
            'Swiss International Air Lines', 'TAAG Linhas A√©reas de Angola',
            'TAP Air Portugal', 'Turkish Airlines', 'United Airlines',
            'OUTRAS CIAS'
        ];

        const TIPOS_SERVICO = [
            'A√©reo', 'A√©reo Facial', 'Hotel', 'A+H', 'A+H+S',
            'Passeios', 'Traslados', 'Traslados + Passeios', 'Ingressos',
            'Seguro', 'Cruzeiro', 'SVA e Outros', 'Loca√ß√£o'
        ];

        let contadorRecibos = 0;

        // ================================================================================
        // üßæ GERENCIAMENTO DE RECIBOS
        // ================================================================================

        function adicionarRecibo() {
            contadorRecibos++;
            
            const container = document.getElementById('recibosContainer');
            const reciboDiv = document.createElement('div');
            reciboDiv.className = 'recibo-container';
            reciboDiv.id = `recibo-${contadorRecibos}`;
            
            reciboDiv.innerHTML = `
                <div class="recibo-header">
                    <div class="recibo-number">üßæ Recibo ${contadorRecibos}</div>
                    <button type="button" class="btn-remove-recibo" onclick="removerRecibo(${contadorRecibos})">
                        üóëÔ∏è Remover
                    </button>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>üìÑ N¬∫ do Recibo</label>
                        <input type="text" name="recibo[]" placeholder="Apenas n√∫meros">
                    </div>
                    
                    <div class="form-group">
                        <label>üìã N¬∫ do Pedido</label>
                        <input type="text" name="pedido[]">
                    </div>
                    
                    <div class="form-group">
                        <label>üé´ Reserva</label>
                        <input type="text" name="reserva[]">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>üéØ Tipo de Servi√ßo</label>
                        <select name="tipo[]" onchange="toggleExtras(this, ${contadorRecibos})" required>
                            <option value="">Selecione...</option>
                            ${TIPOS_SERVICO.map(tipo => `<option value="${tipo}">${tipo}</option>`).join('')}
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>üìÖ Data Ida</label>
                        <input type="date" name="dataIda[]" required>
                    </div>
                    
                    <div class="form-group">
                        <label>üìÖ Data Volta</label>
                        <input type="date" name="dataVolta[]">
                    </div>
                </div>

                <!-- Campos extras para a√©reo -->
                <div class="extra-fields" id="extras-${contadorRecibos}">
                    <h4>‚úàÔ∏è Detalhes A√©reos</h4>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>üè¢ Companhia A√©rea</label>
                            <select name="cia[]">
                                <option value="">Selecione...</option>
                                ${COMPANHIAS_AEREAS.map(cia => 
                                    cia.startsWith('‚îÄ‚îÄ') ? 
                                    `<option disabled>${cia}</option>` : 
                                    `<option value="${cia}">${cia}</option>`
                                ).join('')}
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>üîó LOC GDS</label>
                            <input type="text" name="locGds[]">
                        </div>
                        
                        <div class="form-group">
                            <label>üîó LOC CIA</label>
                            <input type="text" name="locCia[]">
                        </div>
                    </div>

                    <!-- Bagagem e Assento -->
                    <div class="bagagem-assento" id="bagagem-${contadorRecibos}">
                        <div class="checkbox-item">
                            <input type="hidden" name="temBagagem[]" value="false">
                            <input type="checkbox" name="temBagagem[]" value="true" id="bagagem-${contadorRecibos}-check">
                            <label for="bagagem-${contadorRecibos}-check">üß≥ Tem Bagagem?</label>
                        </div>
                        
                        <div class="checkbox-item">
                            <input type="hidden" name="temAssento[]" value="false">
                            <input type="checkbox" name="temAssento[]" value="true" id="assento-${contadorRecibos}-check">
                            <label for="assento-${contadorRecibos}-check">üí∫ Tem Assento Marcado?</label>
                        </div>
                    </div>

                    <!-- Multi Trecho -->
                    <div class="form-group">
                        <label>üîÑ √â Multi Trecho?</label>
                        <select name="multiTrecho[]" onchange="toggleMulti(this, ${contadorRecibos})">
                            <option value="N√£o">N√£o</option>
                            <option value="Sim">Sim</option>
                        </select>
                    </div>

                    <!-- Datas Multi Trecho -->
                    <div class="multi-datas" id="multi-${contadorRecibos}">
                        <h5>üìÖ Datas Intermedi√°rias</h5>
                        <div class="datas-extras" id="datas-extras-${contadorRecibos}"></div>
                        <button type="button" class="btn-add" onclick="adicionarData(${contadorRecibos})">
                            ‚ûï Adicionar Data
                        </button>
                        <button type="button" class="btn-remove" onclick="removerData(${contadorRecibos})">
                            ‚ûñ Remover Data
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label>üí¨ Observa√ß√µes</label>
                    <textarea name="observacoes[]" rows="2" placeholder="Informa√ß√µes adicionais sobre este recibo..."></textarea>
                </div>
            `;
            
            container.appendChild(reciboDiv);
            atualizarBotaoRemover();
            
            console.log(`‚úÖ Recibo ${contadorRecibos} adicionado`);
        }

        function removerRecibo(numero) {
            const recibo = document.getElementById(`recibo-${numero}`);
            if (recibo) {
                recibo.remove();
                console.log(`üóëÔ∏è Recibo ${numero} removido`);
            }
            atualizarBotaoRemover();
        }

        function removerUltimoRecibo() {
            const container = document.getElementById('recibosContainer');
            const ultimoRecibo = container.lastElementChild;
            
            if (ultimoRecibo) {
                ultimoRecibo.remove();
                console.log('üóëÔ∏è √öltimo recibo removido');
            }
            
            atualizarBotaoRemover();
        }

        function atualizarBotaoRemover() {
            const container = document.getElementById('recibosContainer');
            const btnRemover = document.getElementById('btnRemoverRecibo');
            const temRecibos = container.children.length > 0;
            
            btnRemover.style.display = temRecibos ? 'inline-block' : 'none';
        }

        // ================================================================================
        // üîÑ CAMPOS DIN√ÇMICOS
        // ================================================================================

        function toggleExtras(selectElement, reciboId) {
            const extrasDiv = document.getElementById(`extras-${reciboId}`);
            const bagagemDiv = document.getElementById(`bagagem-${reciboId}`);
            
            const tiposAereos = ['A√©reo', 'A√©reo Facial', 'A+H', 'A+H+S'];
            const isAereo = tiposAereos.includes(selectElement.value);
            
            if (extrasDiv) {
                extrasDiv.style.display = isAereo ? 'block' : 'none';
            }
            
            if (bagagemDiv) {
                bagagemDiv.style.display = isAereo ? 'grid' : 'none';
            }
            
            console.log(`üîÑ Extras ${isAereo ? 'mostrados' : 'ocultos'} para recibo ${reciboId}`);
        }

        function toggleMulti(selectElement, reciboId) {
            const multiDiv = document.getElementById(`multi-${reciboId}`);
            const isMulti = selectElement.value === 'Sim';
            
            if (multiDiv) {
                multiDiv.style.display = isMulti ? 'block' : 'none';
            }
            
            console.log(`üîÑ Multi trecho ${isMulti ? 'ativado' : 'desativado'} para recibo ${reciboId}`);
        }

        function adicionarData(reciboId) {
            const container = document.getElementById(`datas-extras-${reciboId}`);
            if (!container) return;
            
            const input = document.createElement('input');
            input.type = 'date';
            input.name = 'datasExtras[]';
            input.style.padding = '0.5rem';
            input.style.border = '1px solid #ddd';
            input.style.borderRadius = '4px';
            
            container.appendChild(input);
            console.log(`üìÖ Data extra adicionada ao recibo ${reciboId}`);
        }

        function removerData(reciboId) {
            const container = document.getElementById(`datas-extras-${reciboId}`);
            if (!container) return;
            
            const ultimaData = container.lastElementChild;
            if (ultimaData) {
                ultimaData.remove();
                console.log(`üìÖ Data extra removida do recibo ${reciboId}`);
            }
        }

        // ================================================================================
        // üìù M√ÅSCARAS E FORMATA√á√ÉO
        // ================================================================================

        document.addEventListener('DOMContentLoaded', function() {
                cpfInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                    e.target.value = value;
                });
            }

            // M√°scara WhatsApp
            const whatsappInput = document.getElementById('whatsappCliente');
            if (whatsappInput) {
                whatsappInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
                    value = value.replace(/(\d)(\d{4})$/, '$1-$2');
                    e.target.value = value;
                });
            }

            // M√°scara para campos de recibo (apenas n√∫meros)
            document.addEventListener('input', function(e) {
                if (e.target.name === 'recibo[]') {
                    e.target.value = e.target.value.replace(/\D/g, '');
                }
            });

            // Adicionar primeiro recibo automaticamente
            adicionarRecibo();

            // Configurar envio do formul√°rio
            const form = document.getElementById('formVendaCompleta');
            if (form) {
                form.addEventListener('submit', enviarVendaCompleta);
            }

            // Configurar sele√ß√£o de radio buttons
            configurarRadioGroups();
        });

        function configurarRadioGroups() {
            document.addEventListener('change', function(e) {
                if (e.target.type === 'radio') {
                    // Remover classe selected de todos os itens do mesmo grupo
                    const groupName = e.target.name;
                    const radioItems = document.querySelectorAll(`input[name="${groupName}"]`);
                    
                    radioItems.forEach(radio => {
                        const radioItem = radio.closest('.radio-item');
                        if (radioItem) {
                            radioItem.classList.remove('selected');
                        }
                    });
                    
                    // Adicionar classe selected ao item selecionado
                    const selectedRadioItem = e.target.closest('.radio-item');
                    if (selectedRadioItem) {
                        selectedRadioItem.classList.add('selected');
                    }
                }
            });
        }

        // ================================================================================
        // üì§ ENVIO DO FORMUL√ÅRIO
        // ================================================================================

        async function enviarVendaCompleta(e) {
            e.preventDefault();
            
            const submitBtn = e.target.querySelector('.btn-submit');
            const textoOriginal = submitBtn.textContent;
            
            try {
                // Mostrar loading
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span class="loading-spinner"></span> Enviando...';
                
                // Coletar dados do formul√°rio
                const dadosVenda = coletarDadosFormulario(e.target);
                
                // Validar dados
                const validacao = validarDadosVenda(dadosVenda);
                if (!validacao.valido) {
                    throw new Error(validacao.erros.join('\n'));
                }
                
                console.log('üì§ Enviando dados da venda:', dadosVenda);
                
                // Enviar para Google Sheets
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'cadastrar_venda_completa',
                        dados: dadosVenda
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    mostrarAlerta('‚úÖ Venda cadastrada com sucesso!', 'success');
                    limparFormulario();
                } else {
                    throw new Error(result.error || 'Erro desconhecido');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao enviar venda:', error);
                mostrarAlerta('Erro ao cadastrar venda:\n' + error.message, 'error');
                
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = textoOriginal;
            }
        }

        function coletarDadosFormulario(form) {
            const formData = new FormData(form);
            const dados = {};
            
            // Processar campos simples
            for (let [key, value] of formData.entries()) {
                if (key.endsWith('[]')) {
                    // Campo array
                    const baseKey = key.slice(0, -2);
                    if (!dados[baseKey]) dados[baseKey] = [];
                    dados[baseKey].push(value);
                } else {
                    // Campo simples
                    dados[key] = value;
                }
            }
            
            // Processar checkboxes de pacote
            const pacotes = [];
            document.querySelectorAll('input[name="pacote"]:checked').forEach(cb => {
                pacotes.push(cb.value);
            });
            dados.pacotes = pacotes;
            
            // Adicionar timestamp
            dados.timestamp = new Date().toISOString();
            dados.dataRegistro = new Date().toLocaleDateString('pt-BR');
            
            return dados;
        }

        function validarDadosVenda(dados) {
            const erros = [];
            
            // Valida√ß√µes obrigat√≥rias
            if (!dados.filial) erros.push('Selecione a filial');
            if (!dados.vendedor) erros.push('Selecione o vendedor');
            if (!dados.cpfCliente) erros.push('CPF do cliente √© obrigat√≥rio');
            if (!dados.nomeCliente) erros.push('Nome do cliente √© obrigat√≥rio');
            if (!dados.seguro) erros.push('Informe a situa√ß√£o do seguro');
            
            // Validar CPF
            if (dados.cpfCliente && !validarCPF(dados.cpfCliente)) {
                erros.push('CPF inv√°lido');
            }
            
            // Validar recibos
            if (!dados.recibo || dados.recibo.length === 0) {
                erros.push('Adicione pelo menos um recibo');
            } else {
                // Verificar se todos os recibos t√™m tipo e data ida
                dados.tipo?.forEach((tipo, index) => {
                    if (!tipo) erros.push(`Tipo √© obrigat√≥rio no recibo ${index + 1}`);
                });
                
                dados.dataIda?.forEach((data, index) => {
                    if (!data) erros.push(`Data ida √© obrigat√≥ria no recibo ${index + 1}`);
                });
            }
            
            return {
                valido: erros.length === 0,
                erros: erros
            };
        }

        function validarCPF(cpf) {
            cpf = cpf.replace(/\D/g, '');
            
            if (cpf.length !== 11) return false;
            if (/^(\d)\1{10}$/.test(cpf)) return false;
            
            let soma = 0;
            for (let i = 0; i < 9; i++) {
                soma += parseInt(cpf.charAt(i)) * (10 - i);
            }
            let digito1 = (soma * 10) % 11;
            if (digito1 === 10) digito1 = 0;
            
            soma = 0;
            for (let i = 0; i < 10; i++) {
                soma += parseInt(cpf.charAt(i)) * (11 - i);
            }
            let digito2 = (soma * 10) % 11;
            if (digito2 === 10) digito2 = 0;
            
            return digito1 === parseInt(cpf.charAt(9)) && digito2 === parseInt(cpf.charAt(10));
        }

        function limparFormulario() {
            const form = document.getElementById('formVendaCompleta');
            form.reset();
            
            // Limpar recibos e adicionar um novo
            document.getElementById('recibosContainer').innerHTML = '';
            contadorRecibos = 0;
            adicionarRecibo();
            
            // Remover classes selected dos radio buttons
            document.querySelectorAll('.radio-item.selected').forEach(item => {
                item.classList.remove('selected');
            });
            
            console.log('üßπ Formul√°rio limpo');
        }

        // ================================================================================
        // üõ†Ô∏è FUN√á√ïES AUXILIARES
        // ================================================================================

        function mostrarAlerta(mensagem, tipo = 'info') {
            // Remover alertas existentes
            document.querySelectorAll('.alerta-temporario').forEach(alerta => alerta.remove());
            
            const alerta = document.createElement('div');
            alerta.className = `alert alert-${tipo} alerta-temporario`;
            alerta.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                max-width: 400px;
                z-index: 10000;
                box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                animation: slideIn 0.3s ease;
            `;
            
            let icone = 'üìù';
            if (tipo === 'success') icone = '‚úÖ';
            if (tipo === 'error') icone = '‚ùå';
            if (tipo === 'info') icone = '‚ÑπÔ∏è';
            
            alerta.innerHTML = `
                ${icone} ${mensagem.replace(/\n/g, '<br>')}
                <button onclick="this.parentElement.remove()" 
                        style="float: right; background: none; border: none; 
                               font-size: 18px; cursor: pointer; margin-left: 10px;">√ó</button>
            `;
            
            document.body.appendChild(alerta);
            
            // Auto-remover ap√≥s 8 segundos
            setTimeout(() => {
                if (alerta.parentElement) {
                    alerta.remove();
                }
            }, 8000);
        }

        // ================================================================================
        // üé® ANIMA√á√ïES E EFEITOS
        // ================================================================================

        // CSS para anima√ß√µes
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            .recibo-container {
                animation: fadeInUp 0.5s ease;
            }
            
            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        `;
        document.head.appendChild(style);

        // ================================================================================
        // üöÄ INICIALIZA√á√ÉO E LOGS
        // ================================================================================

        console.log('üöÄ Sistema de Vendas Completo carregado!');
        console.log('‚ú® Funcionalidades:');
        console.log('   üìã Formul√°rio completo com todos os campos do Google Script');
        console.log('   üßæ Sistema de m√∫ltiplos recibos');
        console.log('   ‚úàÔ∏è Campos espec√≠ficos para a√©reo (CIA, LOC, bagagem, assento)');
        console.log('   üîÑ Multi trecho com datas extras');
        console.log('   üõ°Ô∏è Controle de seguro viagem');
        console.log('   ‚úÖ Valida√ß√µes completas (CPF, campos obrigat√≥rios)');
        console.log('   üì§ Integra√ß√£o com Google Sheets via API');
        console.log('   üé® Interface moderna e responsiva');
        console.log('   üì± M√°scaras autom√°ticas para CPF e WhatsApp');
        
        // Debug functions (apenas em desenvolvimento)
        if (window.location.hostname === 'localhost' || window.location.hostname.includes('github.io')) {
            window.debugVendas = {
                adicionarRecibo: adicionarRecibo,
                simularDados: function() {
                    document.getElementById('cpfCliente').value = '123.456.789-00';
                    document.getElementById('nomeCliente').value = 'Jo√£o da Silva';
                    document.getElementById('whatsappCliente').value = '(11) 99999-9999';
                    document.getElementById('vendedor').value = 'Alessandro';
                    document.querySelector('input[value="6220"]').checked = true;
                    document.querySelector('input[value="Nacional"]').checked = true;
                    document.querySelector('input[value="recusado"]').checked = true;
                    mostrarAlerta('‚úÖ Dados simulados preenchidos!', 'success');
                },
                limparTudo: limparFormulario
            };
            console.log('üß™ Fun√ß√µes de debug dispon√≠veis em window.debugVendas');
        }
    </script>
</body>
</html>
